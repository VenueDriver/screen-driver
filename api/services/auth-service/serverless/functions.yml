authorizer:
  handler: src/auth/authorizer.handler
  envitonment:
    USER_POOL_ID:
      Ref: CognitoUserPool

send_custom_message:
  handler: src/auth/message_customizer.handler

authenticate:
  handler: src/auth/authenticator.handler
  envitonment:
    USER_POOL_ID:
      Ref: CognitoUserPool
    USER_POOL_CLIENT_ID:
      Ref: CognitoAppClient
  events:
    - http:
        path: api/auth/sign_in
        method: post
        cors: true

sign_out:
  handler: src/auth/sign_out.handler
  envitonment:
    USER_POOL_ID:
      Ref: CognitoUserPool
    USER_POOL_CLIENT_ID:
      Ref: CognitoAppClient
  events:
    - http:
        path: api/auth/sign_out
        method: post
        cors: true

refresh_token:
  handler: src/auth_token/auth_token.refresh
  envitonment:
    USER_POOL_ID:
      Ref: CognitoUserPool
    USER_POOL_CLIENT_ID:
      Ref: CognitoAppClient
  events:
    - http:
        path: api/auth/token/refresh
        method: post
        cors: true

create_user:
  handler: src/user/create.create
  envitonment:
    USER_POOL_ID:
      Ref: CognitoUserPool
    USER_POOL_CLIENT_ID:
      Ref: CognitoAppClient
  events:
    - http:
        path: api/auth/users
        method: post
        cors: true
        authorizer: ${self:custom.authorizer}

get_users_list:
  handler: src/user/list.list
  events:
    - http:
        path: api/auth/users
        method: get
        cors: true
        authorizer: ${self:custom.authorizer}

update_user:
  handler: src/user/update.update
  envitonment:
    USER_POOL_ID:
      Ref: CognitoUserPool
    USER_POOL_CLIENT_ID:
      Ref: CognitoAppClient
  events:
    - http:
        path: api/auth/users/{id}
        method: put
        cors: true
        authorizer: ${self:custom.authorizer}

update_user_status:
  handler: src/user/update_status.handler
  envitonment:
    USER_POOL_ID:
      Ref: CognitoUserPool
    USER_POOL_CLIENT_ID:
      Ref: CognitoAppClient
  events:
    - http:
        path: api/auth/users/{id}/enabled
        method: patch
        cors: true
        authorizer: ${self:custom.authorizer}

edit_user_profile:
  handler: src/user/profile.edit
  envitonment:
    USER_POOL_ID:
      Ref: CognitoUserPool
    USER_POOL_CLIENT_ID:
      Ref: CognitoAppClient
  events:
    - http:
        path: api/auth/profile
        method: put
        cors: true
        authorizer: ${self:custom.authorizer}

change_password:
  handler: src/user/profile.changePassword
  envitonment:
    USER_POOL_ID:
      Ref: CognitoUserPool
    USER_POOL_CLIENT_ID:
      Ref: CognitoAppClient
  events:
    - http:
        path: api/auth/profile/change_password
        method: post
        cors: true
        authorizer: ${self:custom.authorizer}

reset_password:
  handler: src/profile/password.reset
  envitonment:
    USER_POOL_ID:
      Ref: CognitoUserPool
    USER_POOL_CLIENT_ID:
      Ref: CognitoAppClient
  events:
    - http:
        path: api/auth/profile/password/reset
        method: post
        cors: true

confirm_reset_password:
  handler: src/profile/password.confirmReset
  envitonment:
    USER_POOL_ID:
      Ref: CognitoUserPool
    USER_POOL_CLIENT_ID:
      Ref: CognitoAppClient
  events:
    - http:
        path: api/auth/profile/password/reset/confirm
        method: post
        cors: true
