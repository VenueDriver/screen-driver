service: screen-driver-api

frameworkVersion: ">=1.1.0 <2.0.0"

provider:
  name: aws
  runtime: nodejs6.10
  environment:
    STAGE: ${opt:stage}
    CONTENT_TABLE: "${self:service}-content-${opt:stage}"
    VENUES_TABLE: "${self:service}-venues-${opt:stage}"
    SETTINGS_TABLE: "${self:service}-settings-${opt:stage}"
    SCHEDULES_TABLE: "${self:service}-schedules-${opt:stage}"
    USERS_TABLE: "${self:service}-users-${opt:stage}"
    USER_POOL: "${self:service}-userpool-${opt:stage}"
    USER_POOL_ID:
      Ref: CognitoUserPool
    USER_POOL_CLIENT: "${self:service}-appclient-${opt:stage}"
    USER_POOL_CLIENT_ID:
      Ref: CognitoAppClient
  iamRoleStatements: ${self:custom.roles}

functions: ${self:custom.functions}

custom:
  properties: ${file(./serverless/properties.yml)}
  functions: ${file(./serverless/functions.yml)}
  resources: ${file(./serverless/resources.yml)}
  roles: ${file(./serverless/roles.yml)}
  dynamodb:
    start:
      port: 8000
      inMemory: true
      migrate: true
    migration:
      dir: migrations

plugins:
  - serverless-dynamodb-local
  - serverless-offline
  - serverless-mocha-plugin
  - serverless-export-env

resources:
  Resources: ${self:custom.resources}

package:
  exclude:
    - docker/**
    - test/**
    - .dockerignore
    - package.json
    - package-lock.json
    - README.md
    - node_modules/serverless-dynamodb-local/**
    - node_modules/dynamodb-localhost/**
    - node_modules/serverless-mocha-plugin/**
    - node_modules/mocha/**
    - node_modules/serverless-offline/**