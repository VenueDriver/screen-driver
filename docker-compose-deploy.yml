version: '2.2'
services:

  build_web:
    env_file:
      - development.env
    build:
      context: web
      dockerfile: ./docker/Dockerfile
    volumes:
      - ./web:/app-src
      - /app-src/node_modules

  deploy_web:
    env_file:
      - development.env
    build:
      context: web
      dockerfile: ./docker/Dockerfile.deploy
    volumes_from:
      - build_web

  deploy_api:
    env_file:
      - development.env
    build:
      context: api
      dockerfile: ./docker/Dockerfile.deploy
      args:
        SERVICE: content-management-service

  deploy_auth_api:
    env_file:
      - development.env
    build:
      context: api
      dockerfile: ./docker/Dockerfile.deploy
      args:
        SERVICE: auth-service

  deploy_maintenance_api:
    env_file:
      - development.env
    build:
      context: api
      dockerfile: ./docker/Dockerfile.deploy
      args:
        SERVICE: maintenance-service

  api_create_user:
    env_file:
      - development.env
    build:
      context: api
      dockerfile: ./docker/Dockerfile.create_user

  build_kiosk:
    env_file:
      - development.env
    build:
      context: kiosk
      dockerfile: ./docker/Dockerfile
    volumes:
      - ./kiosk/dist:/app-src/dist
